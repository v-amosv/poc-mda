{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mda-platform.usafacts.org/schemas/curation/manifest/v2.0.0",
  "title": "Curation Manifest Schema v2.0.0",
  "description": "JSON Schema for validating Curation Engine manifests. Defines the contract for data curation pipelines.",
  "type": "object",
  "required": ["manifest"],
  "properties": {
    "manifest": {
      "type": "object",
      "required": ["identity", "evolution", "agency", "data_model"],
      "properties": {
        "identity": {
          "type": "object",
          "description": "Unique identification of this manifest",
          "required": ["name", "domain", "layer"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Unique manifest identifier",
              "pattern": "^[a-z][a-z0-9_]*$"
            },
            "domain": {
              "type": "string",
              "description": "Business domain classification"
            },
            "layer": {
              "type": "string",
              "enum": ["curation"],
              "description": "Must be 'curation' for curation manifests"
            },
            "description": {
              "type": "string",
              "description": "Human-readable description"
            }
          }
        },
        "evolution": {
          "type": "object",
          "description": "Version and schema tracking",
          "required": ["version", "manifest_schema_version"],
          "properties": {
            "version": {
              "type": "string",
              "description": "Semantic version of this manifest",
              "pattern": "^\\d+\\.\\d+\\.\\d+$"
            },
            "manifest_schema_version": {
              "type": "string",
              "description": "Version of the manifest schema this conforms to",
              "pattern": "^\\d+\\.\\d+\\.\\d+$"
            },
            "changelog": {
              "type": "string",
              "description": "Summary of changes in this version"
            }
          }
        },
        "agency": {
          "type": "object",
          "description": "Execution directives - how to process this manifest",
          "required": ["engine"],
          "properties": {
            "engine": {
              "type": "object",
              "required": ["type", "version"],
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["python", "python_spark", "python_duckdb"],
                  "description": "Curation engine type"
                },
                "version": {
                  "type": "string",
                  "description": "Engine version",
                  "pattern": "^v\\d+$"
                }
              }
            },
            "steps": {
              "type": "array",
              "description": "Pipeline execution steps",
              "items": {
                "type": "object",
                "required": ["name", "action"],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "action": {
                    "type": "string"
                  },
                  "config": {
                    "type": "object"
                  }
                }
              }
            }
          }
        },
        "data_model": {
          "type": "object",
          "description": "Data structure definition",
          "properties": {
            "source": {
              "type": "object",
              "description": "Source data specification"
            },
            "target": {
              "type": "object",
              "description": "Target schema specification"
            },
            "quality": {
              "type": "object",
              "description": "Data quality rules"
            }
          }
        }
      }
    }
  }
}
